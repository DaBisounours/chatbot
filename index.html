<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chatbot</title>
    <!-- Style -->
    <link rel="stylesheet" type="text/css" href="style/reset.css">
    <link rel="stylesheet" type="text/css" href="style/theme.css">
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/synaptic/1.1.4/synaptic.js"></script><!-- NN Library -->
    <script src="scripts/parser/parser.js"></script><!-- Parser -->
    <script src="scripts/nn/keys.js"></script><!-- Data -->
    <script src="scripts/nn/NeuralNetwork.js"></script><!-- NN management -->

    <!-- This page's Scripts -->
    <script>
        /* Gets a random greeting sentence */
        function getGreeting() {
            var greetings = [
                "Bonjour! En quoi puis-je vous aider?",
                "Que voulez vous savoir?",
                "Je me ferai un plaisir de répondre à vos questions!"
            ];
            var randomGreetingIndex = Math.floor((Math.random() * 1000) + 1) % greetings.length;
            return greetings[randomGreetingIndex];
        }

        /* Adds a message from the user */
        function addUserMessage(text) {
            var messageBox = document.createElement("div");
            messageBox.className += "message-box";
            var message = document.createElement("div");
            message.className += "message user-message";
            message.innerHTML = text;
            messageBox.appendChild(message);
            document.getElementById("chat-window").appendChild(messageBox);

        }

        /* Adds a message from the bot */
        function addBotMessage(text) {
            var messageBox = document.createElement("div");
            messageBox.className += "message-box";
            var message = document.createElement("div");
            message.className += "message bot-message";
            message.innerHTML = text;
            messageBox.appendChild(message);
            document.getElementById("chat-window").appendChild(messageBox);
            window.scrollTo(0,document.body.scrollHeight);
        }

        /* Filters key presses on text-area input */
        function enterKeyFilter(event, callback) {
            /* If key pressed is enter */
            if (event.keyCode === 13) {
                /* Look for the text value */
                var input = document.getElementById("text-area");
                var value = input.value;
                /* Add it on the message window */
                addUserMessage(value);
                /* Empty the text input field */
                input.value = "";
                /* Call whatever we want */
                callback(value);
            }
        }

        /* Initialises the page */
        function initialize() {
            /* Set the first message */
            var inputElement = document.getElementById('text-area');
            if (inputElement) {
                addBotMessage(getGreeting());
            }

            /* Create and train the NN */
            chatNN = createNN(keywords.length, answers.length);
            teach(chatNN);

        }

        /* Callback function of submitted value */
        function userSubmitCallback(text) {
            // Add a bot message corresponding to the answer of the Neural network, guessed from the parsed text.
            addBotMessage(activate(chatNN, parseText(text, keywords)));
        }


    </script>
</head>
<body onload="initialize()">
<div class="catbat">
    <div class="user-input box-shadow-outline">

        <input id="text-area" type="text" onkeypress="enterKeyFilter(event, userSubmitCallback)"
               placeholder="Tapez ici..."/>
    </div>
    <div id="chat-window" class=""></div>
</div>

</body>
</html>